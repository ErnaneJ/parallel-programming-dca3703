#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
OUT_DIR="$SCRIPT_DIR/../out"
MAIN_FILE="$SCRIPT_DIR/../main.c"

echo "üëâ Current directory: $SCRIPT_DIR"
mkdir -p "$OUT_DIR"

if [ ! -f "$MAIN_FILE" ]; then
    echo "‚ùå Error: main.c not found in $SCRIPT_DIR!"
    exit 1
fi

echo
read -p "üéØ Enter the compiler to use (e.g., gcc, gcc-14, clang): " COMPILER
echo 
if ! command -v $COMPILER &> /dev/null; then
    echo "‚ùå Error: Compiler '$COMPILER' not found!"
    exit 1
fi

OPT_LEVELS=("O0" "O2" "O3")

for opt in "${OPT_LEVELS[@]}"; do
    echo -e "\n- ‚è≥ Compiling with -${opt} using $COMPILER..."
    $COMPILER -${opt} "$MAIN_FILE" -o "$OUT_DIR/main_${opt}.o"
    echo "-- ‚úÖ Compilation with -${opt} completed!"
    echo "-- üì¶ Output file: $OUT_DIR/main_${opt}.o"

    if [ $? -eq 0 ]; then
        echo -e "- ‚è≥ Running main_${opt}.o...\n"
        "$OUT_DIR/main_${opt}.o"
        echo "- ‚úÖ main_${opt}.o executed successfully!"
    else
        echo "-- ‚ùå Compilation failed for -${opt}"
        exit 1
    fi
done
